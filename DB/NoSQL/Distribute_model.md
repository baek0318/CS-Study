# 분산 모델
>Author: 백승화  
>Created: 2021년 8월 23일 오후 10:00  
>Tags: Nosql, distribute

### NoSQL과 분산 모델
- 수평확장과 수직확장  
웹이 부흥하고 데이터의 크기가 계속해서 증가함에 따라서  
많은 양의 데이터를 저장하기 위해서 저장소의 크기를 키울 수 밖에 없게 되었다  
하지만 하드웨어를 업그레이드를 하는 `수직확장`은 성능 향상에 비해 비용이 많이 든다  
그래서 클러스터를 이용해 `수평확장`을 하는 경우에는 비교적 싼 가격에 많은 양의 데이터를 처리할 수 있게 되었다  
- 클러스터에서 NoSQL이 좋은 이유  
클러스터에서 데이터를 저장하기에는 집합을 자연스러운 단위로 사용할 수 있다고 한다  
그리고 NoSQL은 그래프 데이터베이스를 제외하고는 집합 모델을 사용한다  
그래서 클러스터를 많이 사용해서 구축하는 요즘 트랜드에 NoSQL이 적합한 경우가 많아지고 있다  
- 단점  
  클러스터에서 사용할수록 복잡성이 증가한다 

## 단일 모델
단일 모델은 가장 단순한 분산 방법이다  
왜냐하면 아예 분산을 사용하지 않기 때문이다..😅  
그러므로 거기에 따라 발생하는 비용이 없기 때문에 쉽게 사용할 수 있다  
결과적으로는..  
데이터를 분산하지 않고 처리할 수 있다면 항상 단일 서버 방식을 선택하는 것이 좋다  

## 샤딩 (sharding)
- `필요한 상황`  
  사람들이 서로 다른 데이터 집합에 접근을 계속해서 하는 경우
- `샤딩이란`  
  데이터의 다른 부분을 다른 서버에 두어 수평 확장할 수 있는 기법을 이야기한다
- `고려사항`  
  데이터를 각 노드마다 잘 배치해서 최적의 접근성을 제공해야한다  
  - `문제사항`
    1. 데이터를 어떻게 뭉쳐야지 한 사용자가 한 서버로부터 자원을 얻을 수 있을까
    2. 부하를 균등하게 각 노드마다 배부하는 방법

과거에는 애플리케이션 로직으로 샤딩을 관리하였다  
하지만 그럴 경우에는 모델이 복잡해지므로 사용하기가 쉽지 않게된다  
최근에는 샤딩 로직을 데이터베이스에서 모두 관리를 해준다
그러므로 사용하기가 더 쉬워졌다  

- `장점`
  - 읽기 성능을 향상 시킬 수 있다
- `단점`
  - 복원력은 거의 개선되지 않는다(샤딩만 단독으로 사용할 경우)
  
## 1. 마스터 슬레이브 복제
### 마스터 슬레이브 복제란..
하나의 노드에서 관리하던 데이터베이스를 복제하여서 여러개의 노드에서 관리한다  
노드중에서 하나를 선택하여 `마스터` 라고 하며 나머지를 `슬레이브`로 지칭함으로써  
모든 쓰기 작업은 마스터 노드에서 일어나서 하위 슬레이브로 전파되며  
모든 읽기 작업은 마스터와 슬레이브에서 다 실행되는 형태로 구성되는 것을 이야기한다  

### 적합한 상황
- 쓰기 트래픽에 비해 읽기 트래픽이 많이 발생하는 경우

### 적합하지 않은 상황
- 읽기 트래픽에 비해 쓰기 트래픽이 많이 발생하는 경우  


### 장점
- `읽기 복원력`
  - 하나의 노드가 망가지더라도 다른 노드에서 읽기를 할 수 있기 때문이다
- `많은 읽기 처리`
  - 마스터와 많은 슬레이브가 존재해서 대량의 읽기 요청이 들어오면 한꺼번에 처리가 가능하다  
- `백업 서버로 이용가능`
  - 확장이 필요하지는 않더라도 슬레이브를 백업서버로 이용하여서 마스터가 망가질경우 슬레이브에서 처리하도록 할 수 있다 

### 단점
- `비일관성`
  - 마스터 노드에서 쓰기작업이 발생했는데 업데이트 되기 전에 한명은 마스터에서 한명은 슬레이브에서 읽기를 한 경우 데이터 불일치가 발생한다 

## 2. 피어 투 피어 복제
### 마스터 슬레이브 복제의 문제점
- 마스터가 실패할 경우에 복원력을 제공하지 못한다
- 마스터는 여전히 병목지점이고 단일 실패지점이다

### 피어 투 피어 복제란..
위에서 이야기한 마스터 슬레이브 복제의 문제점을 해소하고자 만들어진것으로  
피어 투 피어 복제에서는 마스터를 따로 두지 않고 모든 노드에서 읽기와 쓰기가 가능하다  

### 장점
- 하나의 노드가 실패하더라도 다른 노드에서 쓰기와 읽기처리가 가능하다
- 노드를 쉽게 추가해서 성능을 향상시킬 수 있다

### 단점
- `비일관성`
  - 두 사람이 동시에 하나의 로우를 업데이트한 경우 쓰기 충돌이 발생할 수 있다
  - `해결방법`
    - 항상 복제본을 조율해 충돌이 발생하지 않도록한다
    - 비일관적 쓰기를 허용한다

## 샤딩과 복제의 결합
