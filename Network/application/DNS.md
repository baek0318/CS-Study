# DNS

>Created: 2021년 10월 20일 오후 2:59  
>Author: 백승화  
>Tags: DNS, UDP

호스트들은 자신을 컴퓨터나 사람이 식별하기 위해서 이름을 가지는데

- `호스트 네임` : 사람들이 외우기 쉬운 이름으로 ex) naver.com, goolge.com...
- `IP` : 컴퓨터가 식별하기 위한 이름으로 대게 32비트의 고정된 길이 값을 가진다

사람들은 자신이 쉽게 식별할 수 있는 호스트 네임으로 웹 브라우저에 검색을 한다

하지만 컴퓨터는 IP 주소가 있어야지만 원하는 호스트에 요청을 할 수 있다

그러므로 호스트 네임 → IP 로 변경 할 수 있어야 하는데

여기서 나온 것이 Domain Name Service의 약자인 DNS라는 것이다

**DNS는...**

- 애플리케이션 계층 프로토콜
- UDP의 전송계층을 사용
- 53번 포트를 고정 사용

우리는 이 애플리케이션 계층 프로토콜인 DNS를 통해서 DNS 서버에 요청을 보냄으로써 호스트 네임 → IP로 변형을 한다

## DNS가 제공하는 서비스

### 호스트 엘리어싱

하나의 호스트가 하나의 정식 호스트 네임을 가진다

하지만 정식 호스트 네임인 경우에는 너무 긴 경우가 존재하기 때문에

해당 네임을 짧게 표현하고 있는 별칭을 제공한다

별칭으로 검색을 하면 정식 호스트 네임을 알 수 있다

### 메일 서버 엘리어싱

호스트 엘리어싱과 비슷하게 gmail.com처럼 풀네임 말고 별칭을 제공한다는 것이다

### 부하 분산

하나의 정식 호스트 네임 아래에는 여러개의 서버가 존재할 수 도 있다

예를 들어서 naver.com의 호스트 네임 아래에

1.1.1.1, 1.1.1.2, 1.1.1.3 총 3개의 IP주소를 각각 가지고 있는 3대의 서버가 존재한다

그래서 클라이언트가 웹 브라우저에 naver.com을 검색하면

DNS가 3개의 IP 주소를 순환하면서 요청이 오는 클라이언트마다 반환해준다

순환으로 IP주소를 반환함으로써 한개의 서버에 부하가 몰리는 것을 분산 할 수 있다

## DNS의 동작 원리

### 간단한 DNS의 동작

1. 클라이언트가 브라우저에 호스트 네임을 입력한다
2. 호스트 네임의 IP주소를 알기위해 DNS의 클라이언트를 호출한다
3. DNS의 클라이언트는 53번 포트로 UDP를 통하여서 DNS 메세지를 전송한다
4. DNS서버가 응답을 해서 DNS 클라이언트로 정보가 들어온다
5. DNS 클라이언트가 응답 메세지를 브라우저에 전송한다

위에서 나오는 간단한 동작만 살펴보았을 때에는 DNS 서버가 단일 서버로 이루어져 있는지 아니면 분산되어져 있는지 알 수 가 없는 블랙박스 형태를 취하고 있다

하지만 단일 서버인 경우 **다음과 같은 문제**가 있다

- 서버의 고장 : 서버가 고장난 경우 모든 시스템이 마비된다
- 트래픽 양 : 하나의 서버가 많은 일을 처리해야한다
- 먼 거리의 중앙 집중 데이터베이스 : 멀리 떨어져 있으면 있을 수 록 굉장한 지연을 발생시키는 원인이 될 수 있다
- 유지관리 : 하나의 데이터베이스가 매우 비대해질 수 있다

그러므로 DNS는 분산 형태를 취하고 있다

### 분산 계층 데이터베이스

DNS 서버는 단일 서버인 경우의 문제점을 해결하기 위해서 **3가지 계층**으로 이루어져 있다

- Root DNS 서버

  모든 DNS 요청의 시작이 되는 서버로써 400개 이상이 전세계에 존재한다

- TLD(Top Level Domain) DNS 서버

  .com .net .org 등.. 해당 도메인을 가지는 책임 DNS서버의 주소를 가진다

- 책임 DNS 서버

  amazon.com, google.com 등.. 해당하는 도메인의 IP주소를 반환해준다

  이것 같은 경우에는 기관에서 직접 책임 DNS 서버를 운영할 수 도 있고 기관에 맡겨서 자신의 record만 보내는 경우도 존재한다

- 로컬 DNS 서버

  위의 3계층에는 포함되지 않지만 꽤나 중요한 부분을 차지하고 있다

    - 자신에게 접근하는 호스트들에게 DHCP를 통해서 IP주소를 할당해주고 기록한다
    - 자신의 하위에 존재하는 호스트가 DNS 요청을 보낼때 Proxy 서버로써 동작한다

### DNS 분산 서버 동작 원리

- 재귀적 방법 & 반복적 방법
- 재귀적 방법

### DNS 캐싱

책임 DNS 서버까지 가면 시간과 부하가 걸리기 때문에 이것을 해결하기 위해서 캐싱을 한다

각 DNS 서버는 자신이 응답했던 것들을 서버 로컬 메모리에 저장하여서 다음에 같은 요청이 온다면 해당 주소를 바로 반환해주면 된다

결과적으로 시간과 부하를 줄여줄 수 있다
