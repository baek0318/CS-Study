# 도메인 영역

도메인 영역은 시스템이 제공할 도메인의 규칙을 구현하는 곳이다

### 도메인 영역 구성요소

- Entity : 도메인의 고유한 개념을 포함하며 도메인 모델의 데이터를 포함하며 해당 데이터와 관련된 기능을 함께 제공한다
- Value : 도메인 객체의 속성을 표현할 때 사용한다
- Aggregate : 관련 객체를 하나로 묶은 군집
- Repository : 도메인 모델의 영속성을 처리한다
- Domain Service : 특정 엔티티에 속하지 않은 도메인 로직을 제공한다

### Entity VS Value

**Entity**

- 고유하게 식별할 수 있는 식별자를 가진다
- 엔티티의 식별자는 변하지 않는다

**Value**

- 고유 식별자를 가지지 않는다
- 개념적으로 완전한 하나를 표현한다 eg) First Name + Last Name = Name
- 불변상태를 가진다 → 안정성을 위해서

### 도메인 모델 엔티티 VS DB 모델 엔티티

**도메인 모델 엔티티**

- 도메인 모델 엔티티는 데이터와 함께 도메인 기능을 함께 제공한다
- 연관 데이터를 묶어서 벨류 타입으로 표현할 수 있다

**DB 모델 엔티티**

- DB 모델 엔티티는 데이터만 제공을 한다

### Aggregate란

관련이 있는 객체들을 묶어서 하나의 Aggregate를 만든다

그러면 하나의 Aggregate에 있는 객체들은 개별 객체로 보는 것이 아니라 하나의 모델로 볼 수 있다

Aggregate는 Aggregate Root를 가진다

Root를 통해서 명령이 들어오고 이 명령을 하위 도메인이나 벨류에 보냄으로써 데이터를 처리하게 된다

**aggregate 설정 범위**

1. 하나의 트랜잭션으로 처리할 수 있어야 한다
2. 하나의 리포지토리로 관리가 가능해야 한다

### Repository는 왜 도메인 계층일까?

결국에는 Repository도 도메인 모델을 다루는 영역이기 때문에 도메인 계층이라고 생각한다

물론 Repository를 고수준 모듈로 추상화를 시킨것이 도메인 영역이고 저수준 모듈은 Infra 영역에 속하게 된다

### 도메인계층 서비스 vs 응용계층 서비스

실제로 둘다 서비스적인 일을 하고 있다

즉 데이터를 가공해서 다음 레이어에 전달해주는 역할을 하는 구간이다

그래서 그냥 들으면 이 두개가 무슨 차이가 있지라고 느낄 수 있다

하지만 자세히 들여다보면 차이가 존재한다

- 도메인 계층 서비스가 필요한 이유
    - 하나의 도메인으로 해당 질의를 해결할 수 없을 경우
    - 예) 할인 금액 계산 : 상품 + 쿠폰 + 회원 등급.. 등 다양한 도메인의 결합
- 응용 계층 서비스가 필요한 이유
    - api 계층과 도메인 계층을 사이에서 이어주는 역할을 해준다
        - 할인 금액을 계산하는 api를 호출한 경우
        - DiscountService를 호출해서 DiscountDomainService에게 위임해서 처리하도록한뒤 결과값만 반환해주는 역할을 하는 것이다