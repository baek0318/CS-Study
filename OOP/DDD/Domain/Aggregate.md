# Aggregate

객체를 개별적인 수준에서 바라보게 되면 전체적인 관계를 파악하는데 굉장한 어려움을 겪는다  
왜냐하면 하나의 도메인에 연결된 하위 도메인들까지 매우 많이 엮여있는 시스템일 수 도 있기 때문이다  
그러므로 도메인들과의 관계를 큰 그림에서 파악하기 위해서 Aggregate를 사용한다

### 얻을 수 있는 이점

- 모델 간의 관계를 상위 수준에서 파악가능
- 개별들끼리 파악하는 것도 가능
- 관리가 용이하다
- 나중에 도메인을 파악할 때 편리하게 파악가능하다

### Aggregate 경계설정

- 하나의 Aggregate에 속할려면 무조건 같은 시기에 생성되어야 한다
- 변경도 같이 일어나야한다
- 보통은 하나의 엔티티를 가진다

## Aggreagate Root

Aggregate에 속한 모든 객체가 일관성을 유지하도록 관리하는 엔티티를 Aggregate Root라고 한다

root를 제외한 다른 곳에서 하위 엔티티나 벨류를 변경할려해서는 안된다

### 도메인 모델에 필요한 규칙

- set메서드를 public으로 만들지 않는다
- Value는 불변으로 구현한다
- 구성요소의 상태만 참조하는 것이 아니라 기능 실행을 위임하기도 한다

### 트랜잭션 범위

- 한번에 하나의 Aggregate만 변경해야한다
- 기술의 제약이나 요구사항으로 인해서 여러개를 변경해야하는 경우 Service에서 처리하자

### Repository와 Aggregate의 관계

- 하나의 Aggregate에 하나의 Repository존재

### Aggregate 팩토리

특정 Aggregate에 있는 데이터를 가지고 다른 Aggregate를 생성해야하는 경우에 데이터를 제공하는 Aggregate에서 팩토리 메서드를 작성하여서 사용하면 Service에 도메인 로직을 노출하지 않은채로 코드를 작성할 수 있다